Гравитация:

Делается капсулькаст вниз.
Если нет коллизии или расстояние до коллизии больше чем расстояние на которое упадет игрок в этот кадр при текущей скорости падения - добавляем все расстояние падения к позиции.
Если коллизия ближе чем прошел бы игрок - ставим игрока на высоту коллизии и записываем нормаль коллизии как нормаль поверхности.
Если угол нормали к вертикали больше допустимого уклона не соскальзывания - добавляется движение соскальзывания.

ВАРИАНТ БЕЗ ДВИЖЕНИЯ ПРИ ПАДЕНИИ И ПРЫЖКЕ:
Если при движении теряется контакт с землей, а скорость движения контроллером не была нулевой - она снижается со временем, 
а движение в падении идет по последнему вектору движения контроллером до потери контакта с землей.
КАК ВАРИАНТ:
Если потеря связи произошла из-за прыжка - скорость движения сохраняется до приземления и снижается до нуля при приземлении.

При возможности движения в воздухе возможно стоит сделать это движение медленнее движения по поверхности.




Соскальзывание:


Стартовой скоростью является текущая скорость падения
Ускорение соскальзывания - ускорение падения * (1 - дот(вектор вверх, нормаль поверхности))
Замедление соскальзывания - ускорение падения * (- дот(вектор вверх, нормаль поверхности))

ВОЗМОЖНО НАДО БРАТЬ ИМЕННО ВЕКТОР ДВИЖЕНИЯ

Вектор соскальзывание - Проэкция вектора вниз на плоскость с нормалью поверхности.
Скорость по вектору - скорость падения. Скольжение это просто падение, но по вектору скольжения.
Если скорость ниже максимальной скорости соскальзывания - постепенно скорость увеличивается с ускорением соскальзывания.
Если скорость выше максимальной скорости соскальзывания - постепенно скорость падает с замедлением соскальзывания.
Далее применяется алгоритм движения, только начальным направлением движения является нормаль скольжения и берется скорость скольжения.




Движение:

При движении делается капсуль каст в сторону движения для проверки возможности двигаться далее.
При коллизии позволяющей движение далее нормаль коллизии становится новой нормалью поверхности.
Движение происходит по вектору движения.
Изначальный Вектор движения - вектор движения на горизонтальной плоскости.
Если уклон поверхности не превышает уклон соскальзывания, то вектор движения  берется по плоскости поверхности:
	Вектор справа - нормализованный кросс продукт ( вектор вверх, вектор движения)
	Вектор нормали поверхности на плоскости движения - проэкция вектора нормали повехности на плоскость с нормальною Вектор справа.
	Вектор движения - проэкция вектора движения на плоскость с нормалью Вектор нормали поверхности на плоскости движения.
Если коллизия находится не пройдя весь путь движения в этот кадр - после коллизии происходит расчет движения с точки коллизии на оставшееся расстояние.
Если коллизия происходит со склоном превышающим порог соскальзывания (подъема) и проверка перешагивания пройдена - нормаль коллизии становится нормалью поверхности, во время движения соскальзывание не применяется.
Если коллизия происходит со склоном превышающим порог соскальзывания (подъема) и проверка перешагивания не пройдена - нормаль коллизии становится нормалью препятствия, движение далее происходит по вдоль этого склона. 
Как происходит движение вдоль препятствия:
	Нормаль препятствия - нормаль поверхности с которой столкнулись (стена или слишком крутой уклон)
	Нормаль поверхности - нормаль поверхности по которой шли до столкновения
	Вектор вправо от движения - нормализованный кросс продукт ( вектор вверх, вектор движения)
	Вектор напрвления валидных векторов движения - Вектор вправо от движения * Sign(дот продукт(Вектор вправо от движения, нормаль препятствия))
	Вектор движения вдоль препятствия - нормализованный Кросс продукт (Нормаль поверхности, Нормаль препятствия) * Sign(дот продукт(Вектор вправо от движения, нормаль препятствия))
	Скорость движения по вектору (может быть отрицательной) - Скорость движения * Max(0, дот продукт(Вектор напрвления валидных векторов движения, нормаль препятствия))

	Если скорость равна или близка к нулю (какой-то диапазон угла движения к препятствию при котором нет движения вдоль) - движение заканчивается.

И так или пока не будет пройдено все расстояние, или пока не будет найдена коллизия останавливающая движение.


	Подумать о ситуации со спуском вдоль стенки в угол внизу склона

	Нужен вектор вправо или влево от вектора первоночального движения в горизонтальной плоскости для определения в какую сторону двигаться и с какой стороны векторы движения валидны.




Проверка на перешагивание:

В случае коллизии при движении чей угол нормали круче максимального угла подъема:
	Надо сделать каст минимальной капсулой с высоты паксимальной ступени так, чтобы проверить можно ли оказаться на расстоянии где оказались бы при максимальном уклоне подъема.
	Если можно или угол нормали коллизии там в пределах угла подъема - продолжаем движение и считаем коллизию поверхностью, а не препятствием.


Проверка движения в WHILE:

Надо придумать проверку которая закончит бесконечный цикл кастов при упирании в угол!